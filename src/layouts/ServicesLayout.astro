---
// Assets
import { Image } from "astro:assets";

// Fundations
import BaseLayout from "@/layouts/BaseLayout.astro";
import Text from "@/components/fundations/elements/Text.astro";
import Kicker from "@/components/fundations/elements/Kicker.astro";
import Button from "@/components/fundations/elements/Button.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";

// Components
import ServiceCard from "@/components/services/ServiceCard.astro";

// Content
import { getCollection } from "astro:content";

const { frontmatter } = Astro.props;

const allServices = await getCollection("services");
const latestServices = allServices
  .filter((service) => service.data.title !== frontmatter.title)
  .slice(0, 2);
---

<BaseLayout navTransparent={true}>

  <!-- HERO (Text + Image on Desktop) -->
  <section class="relative bg-accent-800 overflow-hidden">
    <Wrapper
      variant="standard"
      class="pt-48 pb-12 lg:pt-32 lg:pb-20 lg:border-x lg:border-white/10"


    >
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">

        <!-- LEFT: Hero Text -->
        <div class="relative z-10 max-w-xl">
          <Kicker class="text-base-300">
            {frontmatter.title}
          </Kicker>

          <Text
            tag="h1"
            variant="displayMD"
            class="text-white font-medium tracking-tight mt-12"
          >
            {frontmatter.excerpt}
          </Text>

          <Text
            tag="p"
            variant="textbas"
            class="text-base-300 mt-4"
          >
            {frontmatter.description}
          </Text>

          <ul role="list" class="space-y-1 list-none mt-12">
            {
              frontmatter.highlights?.map((highlight, index) => (
                <li>
                  <Text tag="p" variant="textSM" class="text-base-300">
                    {index + 1}. {highlight}
                  </Text>
                </li>
              ))
            }
          </ul>
        </div>

        <!-- RIGHT: Hero Image (Desktop Only) -->
        <div class="relative hidden lg:block">
          <Image
            width={1400}
            height={1400}
            src={frontmatter.image.url}
            alt={frontmatter.image.alt || frontmatter.title}
            class="w-[120%] h-[460px] object-cover object-center rounded-2xl"
          />

          <!-- Fade Seam -->
          <div
            class="absolute inset-y-0 left-0 w-40
                   bg-gradient-to-r from-accent-800 to-transparent
                   pointer-events-none">
          </div>
        </div>

      </div>
    </Wrapper>
  </section>

  <!-- Image (Mobile Only â€“ Original Flow Preserved) -->
  <section class="lg:hidden">
    <Wrapper variant="paddingless">
      <Image
        width={1400}
        height={1400}
        loading="lazy"
        decoding="async"
        src={frontmatter.image.url}
        alt={frontmatter.image.alt || frontmatter.title}
        class="object-cover object-center w-full max-h-120"
      />
    </Wrapper>
  </section>

  <!-- Content -->
  <Wrapper variant="standard" class="py-12">
    <Wrapper variant="narrow" class="mx-auto">
      <Wrapper variant="prose">
        <slot />
      </Wrapper>
    </Wrapper>
  </Wrapper>

  <!-- Latest Services -->
  {
    latestServices.length > 0 && (
      <section>
        <Wrapper variant="standard" class="py-24">
          <div class="flex flex-col md:flex-row gap-4 md:items-center justify-between">
            <Text
              tag="h2"
              variant="displaySM"
              class="font-medium tracking-tight text-accent-900"
            >
              Latest services
            </Text>

            <Button
              isLink
              size="xs"
              variant="muted"
              href="/services"
              class="w-fit"	
            >
              See all projects
            </Button>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-2 mt-12 lg:mt-24 gap-x-8 gap-y-24">
            {latestServices.map((service) => (
              <ServiceCard service={service} />
            ))}
          </div>
        </Wrapper>
      </section>
    )
  }

</BaseLayout>
